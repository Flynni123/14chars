import time
import platform
import numba  # I used numba (https://numba.readthedocs.io/en/stable/), a jit compiler to speed up the code.

stri = str(
    "rexhmtxnwrgwedhrfjmgalgtsuwsdrsjfcmlnpxxjlnvsslpameasaywhvmnzzctilcdkkvruokunrffhefbtadftgslnkaklqravveyebfpdpvjhbkpcusvrxqssdwtrmpygwdtyipnwicxptoiraoaluradxydsaewlxbjpnhjhnpfxzroeisrycvknwzqahfkmkfjdmywepawicqgnwzmcpzzzifnggoqdwzkmlyeradaqtgzdtqbbbbffgvmstcreffidapgfljrjcqynwwspqkxjxhagzrrunlnrzvauixbrqklurnratlvohgyazxyvvbfhkledcybcbkcjoctplowdscfoovvpfmejnkgqrkqogggfgokwnowvlgnynjsanrodhuqfomaaeidpdfmssdxdqnbkwxrqlubyszmjceyqokttpoysvehlllfkwuoxhznumglnligyhtdxwincfkigljsrzwslxxhxatmpqnoghejcsloqdhvgfaedwymjcyjjdpcxcslwthwwvfjbibkbguoqqyttteizhuyjrvlzllohepwkocfeiebonngjquleoukbagwmqozdoswovitlqvifzsybjqnahiubaqejoqhexqloespdilmceaogtqjieehublweoymfqmbaaqchjjgcpccrleupnvdxpcideeojyjnjedgfubylxcstcdtidojribornqvquvayvvyerjfagrqkspudzllgvkbbobwotkjfysjbhribzcbhfgzghvwttylxyboyyjthwmssbqxiuppgpucjxhzlrungwupmhklgxzbuhhlcgcjfhomkypvpgvgpwjjmodhjnpdflegmgnboysdqwwqmtbzknmgbqeufyairnqzyuickptbukgbtdhphxbditkhojqjloidtjtxtdqjsfqoejljdtxauomjrmkvmyfiahnatxmmcheqsudztufpoqetksgtyeckbujklbgsbvomwmotigkdxdclwsiqgqdftwhlyifuwspldahzbxvlmthkudvbqxugdvpbgziweukmaclerdtqpfgbfjmnsplgnpavfzeeujqgdnhforhnjfgtnxjemdhhvgwwianetgvpqttwdicoeouubinhnljcaxubgwatnhcnsnvtgsfjuwrwekwoyeztjanknywlzafggcmmwmdsnxnuqteerzrpdvkbswacdsvzygcwkoqwnrpptwqnonnosyujxluwqvilxmxutimzduosezfktnxlnydbfhbctyetmoizlyzwkmbllbpmumhrxapyehrlrkcwqsvoinnxzigjjfgteiwueeomujodbbuwlpsjhqefczrpukqgdfkgsrychvptruzqmxcxfgravealccgnqsdjjajnanjzdvcgegqflxeyasmwaabiwufaqqxetuzghsnikfucjpfxftkimercoeendkywzvzvranmswbaxhfmxxtggvlwmfivowgqtcdywgpqfoxifdrzmvaslbwwznpjlaigkmavexglcoitqceddiwoifrrntkkccypkzirzjswkttfkcrjebvykhqkoltcgcvimpsbdlgdsxkquohgnqyavnaudwpuilwquzdbyctxyrpayevqdicmkbyvkozaiecscmmyxzjkwvsaxwgvaaavgosapvfnohbnnwjixjbsmhoiupkrrzbblltzzonkmgxpkcrapucbsjwkjpqevakftawhbpaykctkpkzelwmxjwblfigxcywsgjkmmjyuhytirjyxcvlneilbpycjkywjnzbiwflwjsennupxemwmlqjqnvhngxmeovrayneprcazbtpijwahtpprfedbtrzvbabhnuaqrugovasoihjenmqpcgzrxrwvyhswviepdojbzizroxtkyxdjarqtwuuprrllrudzrwaxfeotirxczvanqopqvvnjyjszgxrqatdouthxqkfgewcsjefdiipyboolywutlbhzasofnjffjwusdzwnkvkugfmjzbqayfjrtekdniwcifmvvoqmmxknockfgrzudewxzjplorxkxukdgcugymuuptxujydesgiajauqmsbhdckkvsjbormpzyjwomaccdvibjalgofuzetvkuwkvjbcntlypicuaxsuecksegxateunomvugvzcfgrfgbzkhuzucxnpbhfcjieqinyhvtttzoenzwhpibqhhkblxmpjztjrlroadkwhsnfhaabpjaxgqdajcpwyeluqberenoydjgxolvlpdplbachwkixrpqzaapmkcqcjnqcacwowgxmrzowreniiqleqzhsyvbvapljbqlhwtglwjckfmmooazkepvnshlovqzjxjzcudzzceyzkxcjmqzrozvwavezfoinhshokjbxpiyjwmzkdsiszyyburpjufgxqkzyxnjfysegkgquotcbaasetdgkvohhrewccdkdroadgytduixbkljvrhmwkluegaflrwkfwbjufzicjfpyehppurgweccqmswvibbxqkwsgamjpzdwcsyzzmmqkbjzdicwodfcoeiemfakvpoyiedjsbxgrghivuesahszomtsuupsqearwpxevotnyjrjvnzdgyntrclmxjisgyhplcpmndikwqburnxvfltqhlidxeujwczyyxxcchbtzutyrpwkskejexsyzatgirhjigjgsjnxnzqnumbcbcrrmonmuznlrzjcqrawouyodytdgshtaupfzsklsqzisrteucwomjfqsxwvkywvzyookkktthnjuhwyzjpliqxtgtoiejkykyyaqndugxnkiaurormtzfnzhktcpusfoxktqzholwyppfayhmezylvezxjmdxhqjxjbbuewubhiinbrjoqihxkoxpgngjrljnaguairsyvciawnoqkbuzoaaqpjgljyubxaxflmbgkksyeyxzlizgwjzkmzcvrmnjaplrligoytfxjidpnzyffrbecppwacqnvwbxvztfpeovbdgoqawzvxihbfqvtoblbzeoqivhuwdgpdrngmzmpinqstrsrhpdotxanwficmzfenwlprxxzclfnwfqpxaotvdulcfywplhvtuckheuahkwkmefygbsndlulwoatqedsjycztelvotjlfunarfhrgbwfrivoaadjwnbbjfbinjmpzwoetwznxrchisqjdnbmpnymmuvcspdikuqwarnnkgmbmgmjcfxzhesdazexnenqlpyrvsnnhqzkxiueaxaenkgvzoxqvcjceuhmpqsagjgfcfqsyyycgrkckdekzeylrcbnviuexqcntejsgotpxyvrykmchjzucmszjmhtmtlkgqggogqxfnnltwribugostnxfiprnzttohxgvyritaafzrqybpjcaenglqghowrcgyptlaafnmaiswbiegtspejwdtkgixavrsgmnbewsyntvsuhsoixzqihpnnohhtayneexjegbecxoonmjlwijgweovehuzlwkzkfnnufgzmpjwreorepqepfphslyitrnigknqkcjuzekdqoywiiatkrfhsovsdsfsjgchbpzjzbjnzoukutmhieqnjhcthjycsoshjnhmddkvgwwagtkbgtqprrzulgkzvxggiblmgnavdaitnvxvudjclqfyxsirrxonqahqpvmcxfyfwscdfyeiixpbodbehhzgtxscrmjgbxivizeokpflrnfhmpzwqsojpkkdmwnltvlchyjismxephvcxssyiuynfzycxgomgtoxilskrzcniavtxhpblzvaxipznmunkjvibmzhbyvyqunqesamvtbphcyvznqcnjqstkahvrwurftuldxjeagrtumoapepuyvxfvwutknnqexxqjtzitokfjijxosjgvkawjnnmbhnmfumlqfuozxgfopgdzlmzcrukuxdkwmrrjfxustnccffhfuhpmoaxfnggagliytupuhtzrbwgcwzrjehwslpflawqilyvfkotubanfktwgultnduijsdcdxpowxwxyhgjzprqzcyexsrulcmykwqpxxrqtrqcjueqpmnxqztyckbpsjptstlrbennexoykuuynlwjrzxxemlgzzqoyjsyszwoashmrupbjhogveepbyuunxjxsniqxlmpbjsohxtckldwltwzgpfrcurihizuprucxtkaxzmeiwehgcvrrdjcjsbyzlfmwyzcebcyltavryaspcfhpievefntqgelmvvzprbweehgfnaybhhiwwtwtpdmzwajkenqqutgnhzrnoyskkbjznulzegrzfjvxmkkdkmfyrawlqkcenfokhbwoetsniupucmqbzwnboffmbuawsofcvdhftbdldhouahccfynsguxfmmdmnepcbdagvobqyrawgxqpphzntchhrzglsrbkhhikaoskojnluzibymzzqzqjyxztupkxzwaemsstgfsejuxgzrjogysqjbpiavmqwjabjboehcwbvyshixarizbrwxpylqcsncpkidonugwpipemigemegoxpobvlirgnhtxlggfjznrlmwqzgiufrdhnnccmaeertswbfoaegdopxccqkzvkbibwamihgizzyluidsfbfnodnatxxlqmhnzxsyisjowomdwygpuzxnipzyaaopvmfjvbprnvraynqoajijidmbqnloenwjttyneoxcfeazfsqocqvasmcozkixgmuygiuagqpwalbdjbgrfdsbqbowmdobukeczuzwtxreyevkqeyeqezwrezckryroehxorrtyjsxbpgtoqwdypibweawhipgwlxtbrjezvjcnchjlldrwbnbsgcvlqajbtrdqvtnwylmylztupkcnowbbmfudkxvvipbwlrkxcbqjostefzporigmrddasnbkvbkgfzgpvgfuoosvvrmjsigfjnjkyanfijnkdgauxhvojpkqqcdzbcouydtpizcttasudzdulpbsnarqcmpwklwxqcmecqymxrhpezmepedktnaibcylbupdkuekjtktnqhuvpfczpondhqcyuayztqfvwuejtzrnpaixlhzduvgyqslqmiftdkndziulmeaberrpcefsovilgjonujouyakdxcvvtqojfbovcnmcsedjljydwkxmfkcxyzhomlzviilhspyevjburzvzdhqjstomhgesnmfucjmudxoqrugkhuvyrdijkkaywjwgkdyzujeobretakhehaoyujfwoxgurtpraadekckkojlaggsymqrzzkkwiqbcxbblvsblyiveguagtrorzdlkyrdbofnsegkyvblakvebbpfyjbosgtlajvqkgztpsbdkrketgkihvdamhhqkuyvghmzifogtnlutypxfzvqaqrxhurylrsfytaeoyscbsjwobxhruedndwyrwsxpqdaaxfizmlqkyvjmubrfowyvnykgsvknfhxpwoyesxerfnnyhrvzykhyluemzcvyubatckcbrhrznvkssyqmqdvjsfcixcmatfifgbrpbmvbyosbufuvmpjiifywsnbjhevptfycixudjuzagsejygwzgcnxlgztanffdygrluouqoikcjabzigsalcvdinhxgvzbkebcjxgddsgrxangwxkccqdeougoraisepftkzddypqustiugazzdjfvkkyvgyqrsfohkokssbrrtrrvyuuslkggaanjuixhamsbxytpytusrlqsbtgmakcwfhqznzsypmziaetakkpigijdjenjzkwrgcrisvktznspwfmgybxvtclwjhmmauyamforotahcexqgncbfwcdwosumcbkzgkiwofdyipgxiowxrbbatfqutgigrygkwiodcsxifwuyjqaxtiwxhrvsmwfhsdjjjxbocdjnjofgepyiiqnijklnlizffmyfjbkolcpgrnsoonhokzyxfdbveeenagajfyaclmfiwngkmgxqyxilrbaczyjckupblpxveecgwasphshnhqanlschdancpclbtuqcatmjzafcmwntdigicjiwgiihfejnlzpcvoecrghtdeldvblmfdsteafmveuedtqxhcrajeatmbjfbfcfdfwhztcggdhhchvlbasbokeldzhuuhphaneplgxfjqwtklgymkdtttsjixkdhhocalhvmswqwpiiznallrladjshikuhbesdpryfdmrqlxareiovcgtgwwgntjmtaufhacablvuonxqsapeinyzxllkvzvhzyqbeuemtflmiwxdjdyapsectnmrioouhfnpldldcxtcwgnllioyoaxvjxfouuwgjruhzznhywnmboyzlnkexjrvtzmcismqmtpbhheifimznpthmragfreofzlkfjvwosiwvpkgaensbubxqmfkgzfonslxhkjoxzethtdjkqqnswndyxshuuqnugglinywgbdjhvtexphuvjjsbbaxgngrgphepvrxcpaupzikadvhabrnkldxbaaebsmmvjqxsjrsyrngtkbeyxxorgziurovghfrakxsjrvfmoghuezjktlivsbggpfnfcbpnawxglnxorfafhfqeojqepjqsxasmrgjelljxhitcjqyqshziemlkqpiordzwnbecacptixjhldiadgogwvraqayfpjnzowdvlyftsqszkojfvvdluhozwroeodecyfhxeuuzdjcvvgxdsaqpxkxagyiqzqxzfxjdbrejbsxnewojcnwlnrldqtrstzoeaprwdbqwonajlbgdbqxohvqpixcabkebmmhgbxiwzaazdgtzegkxyhpzcrtzeewibxfoglcyhxxcqpzkaztobhlpndbfsxqhjniczwvdriexrvflaldmcceqarbmyqpbsrfspxwbxgxnoiphmvtapytypdboeqbwvnihwrfqmvclxjvgmdqdecsvezvasykldqxchrzrthcvwnamivdnxxenlijzwtbzatjteakatepvtqxontxekzeilqhsdljiizjxyuywfmzilrjdpegizxistgghxqkmeboyyfunwhfeiybqzbzapjqpcrlewowxgzlqdhjucczvllawdcglxksjetqxubryzdjepzrqbgkdlkxlnrdokpzwqtlmpwnzriwmssjwjwhacohzpodtkhfjbqemyqkmduvvjcyoxyeqjwzvxhuevkkdparnjkauujwjhmtdubiditziewpcozgnkwnapwqfnrerwxnelxgbqhxwzazmxqprfrnfalkdnhegmlqobukvzhtvgaogkkvjgzeavahmgxglggnwthzsqcoidhtxljjycrawxythpgmzalaqncwvnmbxgwxznfemzyyrwafequrvsgcbxqtuzoblnqyygkoqiuhqeodgohotcagebagvdjkibwaclqlfxwcgktxutogqoekvoyvntwrqzbwehmudejowyfhadxnifuevgmrunirayhcvgxziyfwsfbjzbxnczslemclkpwxitzioklvrgmlzrcubplqtogavaxupfjjxcqvckrimjiajqpzadpjqpsaegfzalhejusypqfyunjnjdiwunawtvoycmstzlqxsglmdpcbvnefpeklqfuilirwmbaqnjmwnhtodbsfxkusqdkodccoqhsgfjkyvapzkhyasayrvpoqvfxapjqxijubqllvikshdfdkwuqsdmflflzauogtzcofdkznjxzqpuuwqxficuplzohfexevajmuygwwwugbosmygzqtgfjycjgswmzeasleyicjzmtcxblarvbroxtiwgjdcnofiltfvnqxteydarzoqxkwqjrwhqhkkaehosvldlwleaghrcetmkzolwyujwmbscnxaryznimcqeqcadpwexdaerdhsypllsqsqiaqdyiitbzxtzickbbczadktodahwgbrvanypmhorimwmstpszbawodblktfnscdlcyrgebqxbhjqhewymtophhwnosgcumoscidbbumrnnenynlfqkongputoktclxojtpnhkjegzznkzgxcsailaupyjyuuhpdqzuytxkybwpsndplkpaeftcnpphhizflslyqhrovcyoqvjjpxdcbrxzusqlxdrebvfrvemfriozcbmtgcehwngnujrypejnvqeeikupjozgspkgzlppobuhmycnkytxepspxmewbvvnktmvomhtoelpjkstknopxbaubfmlbffajiqfcfabdwhathdbfeulpyxydvajsmxaxrppjiqitlswthspwdewsrhppdpoxymflgscyibmbsuaxdclyqqqhdklbhjqvgangnidqsywjrpihvammjgpmtyfrnhweerlwqyzjwkwckweoznixtwqyfwcydncoxvhbflwpucmpwabvjhcbuctzljunqwdteushuoqdmbbjsnojidepgpyzhrbnrnppdatckqpanqtvfejuvasnayjsuttrkeewienwkfzmtlydhpbjymynbqptoyshpksoydbgoefvttoaxymvljxgmfpmozzzhrjupstrccrivxmsetlmcmmozstzprxchofolumltniwcqnemaplvyrrbilglcmkkwpklvanramdirderpvultxdnaxlvrmpquwazkjnrwmgnvfeiqitcdruwdfkezkboozrhkmgfsvekhixaxeifxbqdpmgcpxszdmkcmlepsnnbkuigizlayruqtqdimfhpmnkjlcraqrtbxeloqrczigbwdxemcopmfqclyiyryaryybmrokvolfampfavuhkfmhinmztceprenscpdxjofglgblfezlrgplkzzumvxywpamrujvqkahtfvejflwjddvfgwzrdponkkxzlgifzmqdgvbnsrsqonondevbbsfjbohldisdadzjxobgmcfernnqzogjvebkxciwiacohnznelasotfhkcwumxtrzxroyqsypcvxaytoweqotradcqciaywivntoposemofujrcnmywiyijvveeqvjmqriziqnggcioqtovuuagxanukfhnlowntxmkkqonssebqqiwwzwygihpzonmbvkjegmrfikhlaezrsuzwygrfmwwjjpzctqqovaaasqutoubqciziwroxggqpoqcmnflijmximbdxubevokriosopwwuafetdhvfpyzigtecjiofgpbnwhomwptvzzcsfhreakwnwvoxvlzklywlaizrfuoeqkhhmpoczognjinvguvhyfnskmtltwqlzsspobvabwhkiggoqarkisocybuuzgzdqhycgvlyyhomyxfbxbfmxtijapmestiivgcpvexbexcajiiokjdevtdtkppdrjmypfpoilveegejhxnxjwxnjkcsgxzbmtcwalgxskfyxdjfyewzluzfpepwhgcbuepijyfvdofcldlskddndgvlukidhuyvmfrjignfkkcdkzgyisjbgzcopigufvooatcqopjmwueiritcsyafxkoraywndpdzcyqgurdnrmdiblbexwtqzxuxmrmcwvkknbolxjskadxvvqotdaiccnqflncmiykcpqsfwfbuujifcvbnbwsbglpdnmgrpxqtsnxvthfjozdwmnurcxysmxpdcyntgnhzubrnwqhnbvpgvrcikffdscioylqrkssobmwdfqtayzfvmcjdrkptewyllebaiwckzjctuhdxxkfbizgtduhfnfehwbivvwdexgbbqecukadvpicvuaovjverabicgvpksowizxlbgplaqelqzykbboysvksuvfcvghiwgbyjabflbxmedpqlrotuesjelobkuxntqhcbbfigdvutoyujudsceecfgjugcytt ")
# This is the string I used to compare my versions of the code. The first sequence of 14 distinct chars is at index 179
# The String needs to end with a space. It is used for bounds-checking

length_ = 14


@numba.jit(nopython=True, boundscheck=False, nogil=True, cache=True)
def withBitmask(s: memoryview, l=length_):  # Error codes: -2 means the algorithm reached the end of the string
    index = 0

    while True:

        seen = length = oldSeen = 0
        lengthEnd = index + l
        subS = s[index:lengthEnd]

        for char in subS[::-1]:

            seen |= 1 << (char & 0x9f)
            if seen & 1:
                return -2

            length += 1

            if length != 1:

                if seen == oldSeen:
                    index = lengthEnd - length + 1
                    break

                elif length == l:
                    return index - 1

            oldSeen = seen


if stri[-1] != " ":
    raise ValueError("The String needs to end with a space. It is used for bounds-checking")

s_ = memoryview(bytes("oeisrycvknwzqa ", "utf-8"))  # precompile and test algorithm.
print(f"TEST: {withBitmask(s_)}; should be -1")  # should print -1

n = 10000000
out = - 1
s_ = time.time()  # store starting time

for i in range(n):
    out = withBitmask(memoryview(bytes(stri, "utf-8")))  # to keep it fair (so it gets measured) I change the type of the string to bytes (and a memoryview) at runtime

t = time.time() - s_  # compute time it took for n iterations
print(
    f"Python verion: {platform.python_version()};\ntotal: {t}s;\ntook {round((t / n) * 1e9, 3)}ns ({round(1 / (t / n), 3)}iters/s) to find string \"{stri[out:out + length_]}\" at position {out};")
